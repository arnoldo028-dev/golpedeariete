<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Interactivo - Golpe de Ariete</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --water: #3498db;
            --pipe: #7f8c8d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-5px);
        }
        
        .simulation-area {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }
        }
        
        .visualization {
            height: 350px;
            background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--secondary);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark);
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary);
            cursor: pointer;
            transition: background 0.3s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--primary);
        }
        
        .value-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #666;
        }
        
        .current-value {
            font-weight: bold;
            color: var(--primary);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            flex: 1;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.reset {
            background: var(--accent);
        }
        
        button.reset:hover {
            background: #c0392b;
        }
        
        .calculations {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .calculation-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #ccc;
        }
        
        .calculation-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .calculation-label {
            font-weight: 600;
        }
        
        .calculation-value {
            font-weight: bold;
            color: var(--primary);
        }
        
        .charts {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .charts {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-container {
            position: relative;
            height: 280px;
        }
        
        .theory {
            grid-column: 1 / -1;
        }
        
        h2 {
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 8px;
            font-size: 1.5rem;
        }
        
        h3 {
            margin: 20px 0 12px;
            color: var(--dark);
            font-size: 1.2rem;
        }
        
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        .formula {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            border-left: 5px solid var(--secondary);
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .variables {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .variable {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
            border-left: 3px solid var(--secondary);
        }
        
        .variable .symbol {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .conclusion {
            background: #e1f5fe;
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
            border-left: 5px solid var(--secondary);
        }
        
        .conclusion p {
            margin-bottom: 0;
        }
        
        /* Elementos de visualización */
        .pipe {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 80px;
            background: var(--pipe);
            transform: translateY(-50%);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .water {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--water);
            opacity: 0.7;
            transition: height 0.5s;
        }
        
        .valve {
            position: absolute;
            right: 100px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: #34495e;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.16);
        }
        
        .valve:hover {
            background: #2c3e50;
            transform: translateY(-50%) scale(1.05);
        }
        
        .pressure-wave {
            position: absolute;
            width: 15px;
            height: 70px;
            background: var(--accent);
            border-radius: 8px;
            opacity: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 5;
            transition: left 0.1s linear;
        }
        
        .pulse-indicator {
            position: absolute;
            width: 25px;
            height: 25px;
            background: var(--accent);
            border-radius: 50%;
            opacity: 0;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            transition: opacity 0.3s;
            box-shadow: 0 0 10px var(--accent);
        }
        
        .water-flow {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 10px;
            transform: translateY(-50%);
            z-index: 2;
        }
        
        .flow-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid var(--water);
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.8;
        }
        
        .reservoir {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            width: 80px;
            height: 120px;
            background: #bdc3c7;
            border-radius: 5px;
            z-index: 1;
            overflow: hidden;
        }
        
        .reservoir-water {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80%;
            background: var(--water);
            opacity: 0.7;
        }
        
        .animation-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .animation-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .highlight {
            background-color: #fff9c4;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Simulador Interactivo del Golpe de Ariete</h1>
            <p class="subtitle">Un fenómeno hidráulico fundamental en ingeniería - Visualiza y comprende el efecto del cierre rápido de válvulas en sistemas de tuberías</p>
        </header>
        
        <div class="content">
            <div class="simulation-area">
                <div class="panel">
                    <h2>Simulación del Golpe de Ariete</h2>
                    <div class="visualization" id="visualization">
                        <div class="reservoir">
                            <div class="reservoir-water" id="reservoir-water"></div>
                        </div>
                        <div class="pipe">
                            <div class="water" id="water"></div>
                            <div class="water-flow" id="water-flow"></div>
                        </div>
                        <div class="valve" id="valve">VÁLVULA</div>
                        <div class="pressure-wave" id="pressure-wave"></div>
                        <div class="pulse-indicator" id="pulse-indicator"></div>
                    </div>
                    
                    <div class="animation-controls">
                        <button class="animation-btn" id="slow-motion">
                            <i>Cámara lenta</i>
                        </button>
                        <button class="animation-btn" id="show-wave">
                            <i>Mostrar onda</i>
                        </button>
                    </div>
                </div>
                
                <div class="panel controls">
                    <h2>Parámetros del Sistema</h2>
                    
                    <div class="control-group">
                        <label for="velocity">Velocidad del fluido (m/s)</label>
                        <input type="range" id="velocity" min="0.5" max="5" step="0.1" value="2">
                        <div class="value-display">
                            <span>0.5 m/s</span>
                            <span class="current-value" id="velocity-value">2 m/s</span>
                            <span>5 m/s</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="length">Longitud de tubería (m)</label>
                        <input type="range" id="length" min="50" max="500" step="10" value="200">
                        <div class="value-display">
                            <span>50 m</span>
                            <span class="current-value" id="length-value">200 m</span>
                            <span>500 m</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="diameter">Diámetro de tubería (cm)</label>
                        <input type="range" id="diameter" min="5" max="50" step="1" value="20">
                        <div class="value-display">
                            <span>5 cm</span>
                            <span class="current-value" id="diameter-value">20 cm</span>
                            <span>50 cm</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="elasticity">Módulo de elasticidad (GPa)</label>
                        <input type="range" id="elasticity" min="1" max="200" step="1" value="100">
                        <div class="value-display">
                            <span>1 GPa</span>
                            <span class="current-value" id="elasticity-value">100 GPa</span>
                            <span>200 GPa</span>
                        </div>
                    </div>
                    
                    <div class="calculations">
                        <div class="calculation-item">
                            <span class="calculation-label">Sobrepresión máxima:</span>
                            <span class="calculation-value" id="max-pressure">0 kPa</span>
                        </div>
                        <div class="calculation-item">
                            <span class="calculation-label">Celeridad de la onda:</span>
                            <span class="calculation-value" id="wave-celerity">0 m/s</span>
                        </div>
                        <div class="calculation-item">
                            <span class="calculation-label">Período de oscilación:</span>
                            <span class="calculation-value" id="oscillation-period">0 s</span>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button id="start-btn">
                            <i>▶</i> Iniciar Simulación
                        </button>
                        <button id="reset-btn" class="reset">
                            <i>↺</i> Reiniciar
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="charts">
                <div class="panel">
                    <h2>Variación de Presión en el Tiempo</h2>
                    <div class="chart-container">
                        <canvas id="pressure-chart"></canvas>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Variación de Velocidad en el Tiempo</h2>
                    <div class="chart-container">
                        <canvas id="velocity-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="panel theory">
                <h2>Teoría del Golpe de Ariete</h2>
                
                <p>El <span class="highlight">golpe de ariete</span> (también conocido como pulso de Joukowski) es un fenómeno transitorio hidráulico que ocurre cuando el fluido en movimiento dentro de una tubería es forzado a detenerse o cambiar de dirección súbitamente. Este fenómeno es de gran importancia en el diseño de sistemas de abastecimiento de agua, centrales hidroeléctricas y cualquier sistema de tuberías donde se manipule el flujo de fluidos.</p>
                
                <h3>Mecanismo del fenómeno</h3>
                <p>Cuando una válvula se cierra rápidamente, la inercia del fluido en movimiento genera una onda de presión que viaja a lo largo de la tubería a la velocidad del sonido en el medio. Esta onda se refleja en los extremos del sistema (válvulas, codos, reservorios), creando oscilaciones de presión que pueden alcanzar valores muy elevados, incluso varias veces la presión estática del sistema.</p>
                
                <h3>Ecuaciones fundamentales</h3>
                <div class="formula">
                    ΔP = ρ · c · ΔV
                </div>
                <p>Esta es la <strong>fórmula de Joukowski</strong>, que permite calcular la sobrepresión máxima generada por el golpe de ariete. Donde:</p>
                <div class="variables">
                    <div class="variable">
                        <span class="symbol">ΔP</span>: Sobrepresión (Pa)
                    </div>
                    <div class="variable">
                        <span class="symbol">ρ</span>: Densidad del fluido (kg/m³)
                    </div>
                    <div class="variable">
                        <span class="symbol">c</span>: Celeridad de la onda (m/s)
                    </div>
                    <div class="variable">
                        <span class="symbol">ΔV</span>: Cambio de velocidad (m/s)
                    </div>
                </div>
                
                <div class="formula">
                    c = √(K/ρ) / √(1 + (K·D)/(E·e))
                </div>
                <p>Esta ecuación calcula la <strong>celeridad de la onda de presión</strong> en la tubería. Donde:</p>
                <div class="variables">
                    <div class="variable">
                        <span class="symbol">K</span>: Módulo de elasticidad del fluido (Pa)
                    </div>
                    <div class="variable">
                        <span class="symbol">E</span>: Módulo de elasticidad de la tubería (Pa)
                    </div>
                    <div class="variable">
                        <span class="symbol">D</span>: Diámetro de la tubería (m)
                    </div>
                    <div class="variable">
                        <span class="symbol">e</span>: Espesor de la tubería (m)
                    </div>
                </div>
                
                <h3>Consecuencias y métodos de protección</h3>
                <p>El golpe de ariete puede causar graves daños a los sistemas de tuberías, incluyendo roturas, deformaciones, fallos en componentes y disminución de la vida útil de la instalación. Para mitigar sus efectos se utilizan diversas estrategias:</p>
                <ul>
                    <li><strong>Chimeneas de equilibrio:</strong> Estructuras verticales que absorben las variaciones de presión.</li>
                    <li><strong>Válvulas de alivio:</strong> Dispositivos que liberan presión cuando supera un umbral.</li>
                    <li><strong>Tanques hidroneumáticos:</strong> Recipientes con cámara de aire que actúan como amortiguadores.</li>
                    <li><strong>Volantes de inercia en bombas:</strong> Aumentan el tiempo de parada de las bombas.</li>
                    <li><strong>Cierre gradual de válvulas:</strong> La estrategia más efectiva, extendiendo el tiempo de cierre.</li>
                </ul>
                
                <div class="conclusion">
                    <p><strong>Conclusión:</strong> El golpe de ariete es un fenómeno crítico en el diseño de sistemas hidráulicos. Su comprensión permite implementar medidas de protección adecuadas para garantizar la seguridad, eficiencia y durabilidad de las instalaciones. La simulación y el análisis de este fenómeno son herramientas esenciales para los ingenieros en el diseño de sistemas de fluidos.</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Simulador interactivo de golpe de ariete - Desarrollado para fines educativos en ingeniería hidráulica</p>
        </footer>
    </div>

    <script>
        // Elementos DOM
        const visualization = document.getElementById('visualization');
        const water = document.getElementById('water');
        const reservoirWater = document.getElementById('reservoir-water');
        const valve = document.getElementById('valve');
        const pressureWave = document.getElementById('pressure-wave');
        const pulseIndicator = document.getElementById('pulse-indicator');
        const waterFlow = document.getElementById('water-flow');
        
        const velocitySlider = document.getElementById('velocity');
        const lengthSlider = document.getElementById('length');
        const diameterSlider = document.getElementById('diameter');
        const elasticitySlider = document.getElementById('elasticity');
        
        const velocityValue = document.getElementById('velocity-value');
        const lengthValue = document.getElementById('length-value');
        const diameterValue = document.getElementById('diameter-value');
        const elasticityValue = document.getElementById('elasticity-value');
        
        const maxPressureValue = document.getElementById('max-pressure');
        const waveCelerityValue = document.getElementById('wave-celerity');
        const oscillationPeriodValue = document.getElementById('oscillation-period');
        
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const slowMotionBtn = document.getElementById('slow-motion');
        const showWaveBtn = document.getElementById('show-wave');
        
        // Variables de simulación
        let simulationRunning = false;
        let slowMotion = false;
        let showWave = true;
        let pressureChart, velocityChart;
        let pressureData = [], velocityData = [];
        let timeData = [];
        let time = 0;
        let animationId;
        
        // Constantes
        const WATER_DENSITY = 1000; // kg/m³
        const FLUID_ELASTICITY = 2.2e9; // Pa (módulo de elasticidad del agua)
        const PIPE_THICKNESS = 0.01; // m (espesor de tubería)
        
        // Inicializar gráficos
        function initializeCharts() {
            const pressureCtx = document.getElementById('pressure-chart').getContext('2d');
            const velocityCtx = document.getElementById('velocity-chart').getContext('2d');
            
            pressureChart = new Chart(pressureCtx, {
                type: 'line',
                data: {
                    labels: timeData,
                    datasets: [{
                        label: 'Presión (kPa)',
                        data: pressureData,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Tiempo (s)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Presión (kPa)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
            
            velocityChart = new Chart(velocityCtx, {
                type: 'line',
                data: {
                    labels: timeData,
                    datasets: [{
                        label: 'Velocidad (m/s)',
                        data: velocityData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Tiempo (s)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Velocidad (m/s)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }
        
        // Actualizar valores mostrados
        function updateDisplayedValues() {
            velocityValue.textContent = `${velocitySlider.value} m/s`;
            lengthValue.textContent = `${lengthSlider.value} m`;
            diameterValue.textContent = `${diameterSlider.value} cm`;
            elasticityValue.textContent = `${elasticitySlider.value} GPa`;
            
            // Actualizar cálculos
            const celerity = calculateWaveCelerity();
            const maxOverpressure = calculateMaxOverpressure();
            const period = calculateWavePeriod();
            
            waveCelerityValue.textContent = `${celerity.toFixed(0)} m/s`;
            maxPressureValue.textContent = `${maxOverpressure.toFixed(1)} kPa`;
            oscillationPeriodValue.textContent = `${period.toFixed(2)} s`;
        }
        
        // Calcular celeridad de la onda
        function calculateWaveCelerity() {
            const diameter = parseFloat(diameterSlider.value) / 100; // Convertir a metros
            const elasticity = parseFloat(elasticitySlider.value) * 1e9; // Convertir a Pa
            
            // Fórmula simplificada de la celeridad
            const denominator = 1 + (FLUID_ELASTICITY * diameter) / (elasticity * PIPE_THICKNESS);
            const celerity = Math.sqrt(FLUID_ELASTICITY / WATER_DENSITY) / Math.sqrt(denominator);
            
            return celerity;
        }
        
        // Calcular sobrepresión máxima
        function calculateMaxOverpressure() {
            const velocity = parseFloat(velocitySlider.value);
            const celerity = calculateWaveCelerity();
            
            // Fórmula de Joukowski
            const overpressure = WATER_DENSITY * celerity * velocity;
            
            return overpressure / 1000; // Convertir a kPa
        }
        
        // Calcular período de la onda
        function calculateWavePeriod() {
            const length = parseFloat(lengthSlider.value);
            const celerity = calculateWaveCelerity();
            
            // Tiempo que tarda la onda en ir y volver
            return (2 * length) / celerity;
        }
        
        // Crear flechas de flujo
        function createFlowArrows() {
            waterFlow.innerHTML = '';
            const velocity = parseFloat(velocitySlider.value);
            const arrowCount = Math.min(10, Math.max(3, Math.floor(velocity * 2)));
            
            for (let i = 0; i < arrowCount; i++) {
                const arrow = document.createElement('div');
                arrow.className = 'flow-arrow';
                arrow.style.left = `${10 + (i * 80 / arrowCount)}%`;
                arrow.style.animation = `flowAnimation ${2/velocity}s linear infinite`;
                waterFlow.appendChild(arrow);
            }
        }
        
        // Simular golpe de ariete
        function simulateWaterHammer() {
            if (!simulationRunning) return;
            
            const timeStep = slowMotion ? 0.05 : 0.1;
            time += timeStep;
            timeData.push(time.toFixed(1));
            
            const period = calculateWavePeriod();
            const maxOverpressure = calculateMaxOverpressure();
            const initialVelocity = parseFloat(velocitySlider.value);
            
            // Modelo simplificado de la oscilación de presión
            const pressure = maxOverpressure * Math.sin(2 * Math.PI * time / period) * Math.exp(-time / (2 * period));
            pressureData.push(pressure);
            
            // Modelo simplificado de la oscilación de velocidad
            const velocity = initialVelocity * Math.cos(2 * Math.PI * time / period) * Math.exp(-time / (2 * period));
            velocityData.push(velocity);
            
            // Actualizar visualización
            updateVisualization(pressure, velocity);
            
            // Actualizar gráficos
            pressureChart.data.labels = timeData;
            pressureChart.data.datasets[0].data = pressureData;
            pressureChart.update();
            
            velocityChart.data.labels = timeData;
            velocityChart.data.datasets[0].data = velocityData;
            velocityChart.update();
            
            // Continuar simulación hasta 4 períodos
            if (time < 4 * period) {
                animationId = setTimeout(simulateWaterHammer, slowMotion ? 100 : 50);
            } else {
                simulationRunning = false;
                startBtn.innerHTML = '<i>▶</i> Iniciar Simulación';
            }
        }
        
        // Actualizar visualización
        function updateVisualization(pressure, velocity) {
            // Ajustar nivel de agua según presión
            const waterLevel = 50 + (pressure / 5); // Relación simplificada
            water.style.height = `${Math.max(10, Math.min(90, waterLevel))}%`;
            reservoirWater.style.height = `${Math.max(30, Math.min(95, 80 - pressure/10))}%`;
            
            // Mostrar pulso de presión
            if (Math.abs(pressure) > 10) {
                pulseIndicator.style.opacity = '0.8';
                pulseIndicator.style.backgroundColor = pressure > 0 ? '#e74c3c' : '#3498db';
                pulseIndicator.style.left = `${50 + pressure / 5}%`;
                
                // Onda de presión
                if (showWave) {
                    pressureWave.style.opacity = '0.7';
                    pressureWave.style.backgroundColor = pressure > 0 ? '#e74c3c' : '#3498db';
                    pressureWave.style.left = `${70 - (time * 10) % 80}%`;
                }
            } else {
                pulseIndicator.style.opacity = '0';
                pressureWave.style.opacity = '0';
            }
            
            // Cambiar color de la válvula según presión
            if (pressure > 50) {
                valve.style.backgroundColor = '#e74c3c';
                valve.style.boxShadow = '0 0 15px #e74c3c';
            } else if (pressure < -20) {
                valve.style.backgroundColor = '#3498db';
                valve.style.boxShadow = '0 0 15px #3498db';
            } else {
                valve.style.backgroundColor = '#34495e';
                valve.style.boxShadow = '0 3px 6px rgba(0,0,0,0.16)';
            }
            
            // Actualizar flechas de flujo según velocidad
            const arrows = document.querySelectorAll('.flow-arrow');
            arrows.forEach(arrow => {
                arrow.style.animationDuration = `${2/Math.max(0.1, velocity)}s`;
                arrow.style.opacity = Math.max(0.3, velocity/5);
            });
        }
        
        // Iniciar simulación
        function startSimulation() {
            if (simulationRunning) {
                simulationRunning = false;
                clearTimeout(animationId);
                startBtn.innerHTML = '<i>▶</i> Iniciar Simulación';
            } else {
                // Reiniciar datos
                pressureData = [];
                velocityData = [];
                timeData = [];
                time = 0;
                
                simulationRunning = true;
                startBtn.innerHTML = '<i>⏸</i> Pausar Simulación';
                
                // Actualizar gráficos con datos vacíos
                pressureChart.data.labels = timeData;
                pressureChart.data.datasets[0].data = pressureData;
                
                velocityChart.data.labels = timeData;
                velocityChart.data.datasets[0].data = velocityData;
                
                // Iniciar simulación
                simulateWaterHammer();
            }
        }
        
        // Reiniciar simulación
        function resetSimulation() {
            simulationRunning = false;
            clearTimeout(animationId);
            
            pressureData = [];
            velocityData = [];
            timeData = [];
            time = 0;
            
            // Restablecer visualización
            water.style.height = '100%';
            reservoirWater.style.height = '80%';
            pulseIndicator.style.opacity = '0';
            pressureWave.style.opacity = '0';
            valve.style.backgroundColor = '#34495e';
            valve.style.boxShadow = '0 3px 6px rgba(0,0,0,0.16)';
            
            // Actualizar gráficos
            pressureChart.data.labels = timeData;
            pressureChart.data.datasets[0].data = pressureData;
            pressureChart.update();
            
            velocityChart.data.labels = timeData;
            velocityChart.data.datasets[0].data = velocityData;
            velocityChart.update();
            
            startBtn.innerHTML = '<i>▶</i> Iniciar Simulación';
            
            // Recrear flechas de flujo
            createFlowArrows();
        }
        
        // Cerrar válvula (simulación de evento)
        function closeValve() {
            if (!simulationRunning) {
                startSimulation();
            }
        }
        
        // Alternar cámara lenta
        function toggleSlowMotion() {
            slowMotion = !slowMotion;
            slowMotionBtn.style.backgroundColor = slowMotion ? var(--primary) : var(--secondary);
        }
        
        // Alternar visualización de onda
        function toggleShowWave() {
            showWave = !showWave;
            showWaveBtn.style.backgroundColor = showWave ? var(--primary) : var(--secondary);
            pressureWave.style.opacity = showWave ? '0' : '0';
        }
        
        // Event listeners
        velocitySlider.addEventListener('input', updateDisplayedValues);
        lengthSlider.addEventListener('input', updateDisplayedValues);
        diameterSlider